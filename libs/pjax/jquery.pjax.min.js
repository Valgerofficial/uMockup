!function(f){function t(t,e,n){return n=u(e,n),this.on("click.pjax",t,function(t){var e=n;e.container||((e=f.extend({},n)).container=f(this).attr("data-pjax")),a(t,e)})}function a(t,e,n){n=u(e,n);var a=t.currentTarget,e=f(a);if("A"!==a.tagName.toUpperCase())throw"$.fn.pjax or $.pjax.click requires an anchor element";1<t.which||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||location.protocol===a.protocol&&location.hostname===a.hostname&&(-1<a.href.indexOf("#")&&s(a)==s(location)||t.isDefaultPrevented()||(a={url:a.href,container:e.attr("data-pjax"),target:a},a=f.extend({},a,n),n=f.Event("pjax:click"),e.trigger(n,[a]),n.isDefaultPrevented()||(h(a),t.preventDefault(),e.trigger("pjax:clicked",[a]))))}function e(t,e,n){n=u(e,n);var a=t.currentTarget,r=f(a);if("FORM"!==a.tagName.toUpperCase())throw"$.pjax.submit requires a form element";e={type:(r.attr("method")||"GET").toUpperCase(),url:r.attr("action"),container:r.attr("data-pjax"),target:a};if("GET"!==e.type&&void 0!==window.FormData)e.data=new FormData(a),e.processData=!1,e.contentType=!1;else{if(r.find(":file").length)return;e.data=r.serializeArray()}h(f.extend({},e,n)),t.preventDefault()}function h(u){u=f.extend(!0,{},f.ajaxSettings,h.defaults,u),f.isFunction(u.url)&&(u.url=u.url());var l=y(u.url).hash,t=f.type(u.container);if("string"!==t)throw"expected string value for 'container' option; got "+t;var n,p=u.context=f(u.container);if(!p.length)throw"the container selector '"+u.container+"' did not match anything";function d(t,e,n){(n=n||{}).relatedTarget=u.target;n=f.Event(t,n);return p.trigger(n,e),!n.isDefaultPrevented()}u.data||(u.data={}),f.isArray(u.data)?u.data.push({name:"_pjax",value:u.container}):u.data._pjax=u.container,u.beforeSend=function(t,e){if("GET"!==e.type&&(e.timeout=0),t.setRequestHeader("X-PJAX","true"),t.setRequestHeader("X-PJAX-Container",u.container),!d("pjax:beforeSend",[t,e]))return!1;0<e.timeout&&(n=setTimeout(function(){d("pjax:timeout",[t,u])&&t.abort("timeout")},e.timeout),e.timeout=0);e=y(e.url);l&&(e.hash=l),u.requestUrl=c(e)},u.complete=function(t,e){n&&clearTimeout(n),d("pjax:complete",[t,e,u]),d("pjax:end",[t,u])},u.error=function(t,e,n){var a=w("",t,u),n=d("pjax:error",[t,e,n,u]);"GET"==u.type&&"abort"!==e&&n&&m(a.url)},u.success=function(t,e,n){var a=h.state,r="function"==typeof f.pjax.defaults.version?f.pjax.defaults.version():f.pjax.defaults.version,o=n.getResponseHeader("X-PJAX-Version"),i=w(t,n,u),c=y(i.url);if(l&&(c.hash=l,i.url=c.href),r&&o&&r!==o)m(i.url);else if(i.contents){if(h.state={id:u.id||g(),url:i.url,title:i.title,container:u.container,fragment:u.fragment,timeout:u.timeout},(u.push||u.replace)&&window.history.replaceState(h.state,i.title,i.url),f.contains(p,document.activeElement))try{document.activeElement.blur()}catch(t){}i.title&&(document.title=i.title),d("pjax:beforeReplace",[i.contents,u],{state:h.state,previousState:a}),p.html(i.contents);var s,o=p.find("input[autofocus], textarea[autofocus]").last()[0];o&&document.activeElement!==o&&o.focus(),(a=i.scripts)&&(s=f("script[src]"),a.each(function(){var t,e,n=this.src;s.filter(function(){return this.src===n}).length||(t=document.createElement("script"),(e=f(this).attr("type"))&&(t.type=e),t.src=f(this).attr("src"),document.head.appendChild(t))}));o=u.scrollTo;l&&(a=decodeURIComponent(l.slice(1)),(a=document.getElementById(a)||document.getElementsByName(a)[0])&&(o=f(a).offset().top)),"number"==typeof o&&f(window).scrollTop(o),d("pjax:success",[t,e,n,u])}else m(i.url)},h.state||(h.state={id:g(),url:window.location.href,title:document.title,container:u.container,fragment:u.fragment,timeout:u.timeout},window.history.replaceState(h.state,document.title)),x(h.xhr),h.options=u;var e,a=h.xhr=f.ajax(u);return 0<a.readyState&&(u.push&&!u.replace&&(e=h.state.id,t=[u.container,v(p)],b[e]=t,E.push(e),S(T,0),S(E,h.defaults.maxCacheLength),window.history.pushState(null,"",u.requestUrl)),d("pjax:start",[a,u]),d("pjax:send",[a,u])),h.xhr}function n(t,e){var n={url:window.location.href,push:!1,replace:!0,scrollTo:!1};return h(f.extend(n,u(t,e)))}function m(t){window.history.replaceState(null,"",h.state.url),window.location.replace(t)}var l=!0,p=window.location.href,r=window.history.state;function o(t){l||x(h.xhr);var e,n,a=h.state,r=t.state;if(r&&r.container){if(l&&p==r.url)return;if(a){if(a.id===r.id)return;o=a.id<r.id?"forward":"back"}var o,i=b[r.id]||[],c=i[0]||r.container,s=f(c),u=i[1];s.length?(a&&(e=o,t=a.id,i=[c,v(s)],b[t]=i,e="forward"===e?(n=E,T):(n=T,E),n.push(t),(t=e.pop())&&delete b[t],S(n,h.defaults.maxCacheLength)),o=f.Event("pjax:popstate",{state:r,direction:o}),s.trigger(o),c={id:r.id,url:r.url,container:c,push:!1,fragment:r.fragment,timeout:r.timeout,scrollTo:!1},u?(s.trigger("pjax:start",[null,c]),(h.state=r).title&&(document.title=r.title),a=f.Event("pjax:beforeReplace",{state:r,previousState:a}),s.trigger(a,[u,c]),s.html(u),s.trigger("pjax:end",[null,c])):h(c),s[0].offsetHeight):m(location.href)}l=!1}function i(t){var e=f.isFunction(t.url)?t.url():t.url,n=t.type?t.type.toUpperCase():"GET",a=f("<form>",{method:"GET"===n?"GET":"POST",action:e,style:"display:none"});"GET"!==n&&"POST"!==n&&a.append(f("<input>",{type:"hidden",name:"_method",value:n.toLowerCase()}));var r,o=t.data;if("string"==typeof o)f.each(o.split("&"),function(t,e){e=e.split("=");a.append(f("<input>",{type:"hidden",name:e[0],value:e[1]}))});else if(f.isArray(o))f.each(o,function(t,e){a.append(f("<input>",{type:"hidden",name:e.name,value:e.value}))});else if("object"==typeof o)for(r in o)a.append(f("<input>",{type:"hidden",name:r,value:o[r]}));f(document.body).append(a),a.submit()}function x(t){t&&t.readyState<4&&(t.onreadystatechange=f.noop,t.abort())}function g(){return(new Date).getTime()}function v(t){t=t.clone();return t.find("script").each(function(){this.src||f._data(this,"globalEval",!1)}),t.contents()}function c(t){return t.search=t.search.replace(/([?&])(_pjax|_)=[^&]*/g,"").replace(/^&/,""),t.href.replace(/\?($|#)/,"$1")}function y(t){var e=document.createElement("a");return e.href=t,e}function s(t){return t.href.replace(/#.*/,"")}function u(t,e){return t&&e?((e=f.extend({},e)).container=t,e):f.isPlainObject(t)?t:{container:t}}function d(t,e){return t.filter(e).add(t.find(e))}function j(t){return f.parseHTML(t,document,!0)}function w(t,e,n){var a,r={},o=/<html/i.test(t),e=e.getResponseHeader("X-PJAX-URL");return r.url=e?c(y(e)):n.requestUrl,t=o?(a=f(j(t.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0])),null!=(e=t.match(/<head[^>]*>([\s\S.]*)<\/head>/i))?f(j(e[0])):a):a=f(j(t)),0===a.length||(r.title=d(t,"title").last().text(),n.fragment?(t=a,"body"!==n.fragment&&(t=d(t,n.fragment).first()),t.length&&(r.contents="body"===n.fragment?t:t.contents(),r.title||(r.title=t.attr("title")||t.data("title")))):o||(r.contents=a),r.contents&&(r.contents=r.contents.not(function(){return f(this).is("title")}),r.contents.find("title").remove(),r.scripts=d(r.contents,"script[src]").remove(),r.contents=r.contents.not(r.scripts)),r.title&&(r.title=f.trim(r.title))),r}r&&r.container&&(h.state=r),"state"in window.history&&(l=!1);var b={},T=[],E=[];function S(t,e){for(;t.length>e;)delete b[t.shift()]}function P(){return f("meta").filter(function(){var t=f(this).attr("http-equiv");return t&&"X-PJAX-VERSION"===t.toUpperCase()}).attr("content")}function C(){f.fn.pjax=t,f.pjax=h,f.pjax.enable=f.noop,f.pjax.disable=A,f.pjax.click=a,f.pjax.submit=e,f.pjax.reload=n,f.pjax.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:P},f(window).on("popstate.pjax",o)}function A(){f.fn.pjax=function(){return this},f.pjax=i,f.pjax.enable=C,f.pjax.disable=f.noop,f.pjax.click=f.noop,f.pjax.submit=f.noop,f.pjax.reload=function(){window.location.reload()},f(window).off("popstate.pjax",o)}f.event.props&&f.inArray("state",f.event.props)<0?f.event.props.push("state"):"state"in f.Event.prototype||f.event.addProp("state"),f.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/),(f.support.pjax?C:A)()}(jQuery);
